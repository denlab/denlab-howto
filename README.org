#+STARTUP: logdone
#+STARTUP: hidestars

* template

#+begin_src sh

#+end_src
* Linux
** Io
*** redirecting stdout, stderr

#+begin_src sh
# stdout to stderr
echo x >&2
# stdout and stderr to file
cmd &> file 
# stderr to stdout
ls 2>&1
#+end_src

** Find
*** find files modified in the last x minutes
#+begin_src sh
find . -cmin -5
#+end_src
*** handle filenames with spaces ?
#+begin_src sh
find . -maxdepth 1 -print0 | while read -d $'\0' d ; do echo $d ; done
#+end_src
http://www.cyberciti.biz/tips/handling-filenames-with-spaces-in-bash.html

** User Admin
*** how to add a group to a user ? 
#+begin_src sh
sudo usermod -aG docker u
#+end_src
*** add a user with specific groups ? 
#+begin_src sh
adduser -G group1,group2 <user>
#+end_src

*** get the groups of a user ?
#+begin_src sh
groups <user>
#+end_src
*** change the shell of a user?
#+begin_src sh
usermod -s /bin/bash user
#+end_src
*** remove a user?
#+begin_src sh
export U=<user>
userdel -r $U
#+end_src
*** add a user?
#+begin_src sh
adduser <user>
#+end_src

** Ssh
*** generate public private key pair
#+begin_src sh
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
#+end_src

*** ssh reverse tunnel ?

#+begin_src sh
# from the target machine:
ssh -R 2210:localhost:22 bserver.outside.com
#+end_src
from: https://toic.org/blog/2009/reverse-ssh-port-forwarding/

*** ssh or scp in a script without entering password ?

#+begin_src sh
expect -c "
   spawn scp login@somehost.com:/somefile .
   expect yes/no { send yes\r ; exp_continue }
   expect password: { send password\r }
   expect 100%
   exit
"
#+end_src

*** ssh without password or key? 
#+begin_src sh
# remove password for user
passwd -d user
# sshd: allow empty password
sed -r 's/#(PermitEmptyPasswords) no/\1 yes/' -i.bak /etc/ssh/sshd_config
#+end_src

** Services mgmt
*** Linux reload service config
#+begin_src sh
sudo systemctl daemon-reload
#+end_src
** Centos
*** manage services?
#+begin_src sh
# list all services
systemctl list-unit-files --type=service

# check if a service is running
systemctl status name.service

# enable a service
#+end_src
** Terminal
*** replace capslock by ctrl in console ?
#+begin_src sh
#in  /etc/default/keyboard
#replace XKBOPTIONS="" by XKBOPTIONS="ctrl:nocaps"
# then run
run sudo dpkg-reconfigure -phigh console-setup
#+end_src

ref: https://www.emacswiki.org/emacs/MovingTheCtrlKey#toc9

* Docker
** find images on the command line ? 
???
** docker run/start/exec ?

| run   | run cmd in *new* container     |
| exec  | run cmd in *running* container |
| start | start a *stopped* container    |
** troubleshoot ubuntu network ? 
- ping 8.8.8.8 but no www.google.com ? 
- incomplete response: 
#+begin_src sh
# Find your network's DNS server:
$ nmcli dev show | grep 'IP4.DNS'
IP4.DNS[1]:                             10.19.18.25

# Open up /lib/systemd/system/docker.service and add DNS settings to the ExecStart line:
ExecStart=/usr/bin/docker daemon --dns 8.8.8.8 --dns 10.19.18.25 -H fd://
#+end_src
From: http://askubuntu.com/questions/475764/docker-io-dns-doesnt-work-its-trying-to-use-8-8-8-8
** Docker Compose
*** commands ? 
| cmd     | act on   | type      | target  | service | all | descr                                                     |
|         |          |           | state   |         |     |                                                           |
|---------+----------+-----------+---------+---------+-----+-----------------------------------------------------------|
| build   | img      | build     | any     | Y       | Y   | Build or rebuild services                                 |
| create  | cont     | lifecycle | any     | Y       | Y   | Create services                                           |
| start   | cont     | lifecycle | stopped | Y       | Y   | Start services                                            |
| up      | cont     | lifecycle | stopped | Y       | Y   | Create and start containers                               |
| run     | cont     | lifecycle |         | Y       | N   | Run a one-off command                                     |
| exec    | cont     | lifecycle | running | Y       | N   | Execute a command in a running container                  |
| stop    | cont     | lifecycle | stopped | Y       | Y   | Stop services                                             |
| kill    | cont     | lifecycle | running | Y       | Y   | Kill containers                                           |
| down    | img/cont | lifecycle | running | N       | Y   | Stop and remove containers, networks, images, and volumes |
| rm      | cont     | lifecycle | stopped | Y       | Y   | Remove stopped containers                                 |
| restart | cont     | lifecycle | running | Y       | Y   | Restart services                                          |
|---------+----------+-----------+---------+---------+-----+-----------------------------------------------------------|
| unpause | cont     | lifecycle | paused  | Y       | Y   | Unpause services                                          |
| pause   | cont     | lifecycle | running | Y       | Y   | Pause services                                            |
| scale   | cont     | lifecycle |         | Y       | Y   | Set number of containers for a service                    |
|---------+----------+-----------+---------+---------+-----+-----------------------------------------------------------|
| config  | compose  |           |         | N       | Y   | Validate and view the compose file                        |
| bundle  | img      |           |         | ?       | ?   | Generate a Docker bundle from the Compose file            |
| pull    | img      |           |         | Y       | Y   | Pulls service images                                      |
| push    | img      |           |         | Y       | Y   | Push service images                                       |
| events  | cont     | infos     |         | Y       | Y   | Receive real time events from containers                  |
| logs    | cont     | infos     |         | Y       | Y   | View output from containers                               |
| port    | cont     | infos     |         | Y       | N   | Print the public port for a port binding                  |
| ps      | cont     | infos     |         | Y       | Y   | List containers                                           |
| help    | special  | infos     |         | N       | N   | Get help on a command                                     |
| version | special  | infos     |         | N       | N   | Show the Docker-Compose version information               |

* Git
** how to delete a remote branch ? 
#+begin_src sh
git push origin --delete feature/example
#+end_src
* Jq
** Recursively find a value by key?
#+begin_src sh
echo '[{"a": 1}, {"b": 2}]' | jq '.. | .a? // empty'
# => 1
#+end_src
* Apt-get
** dpkg show all installed files of a .deb?

#+begin_src sh
dpkg -L jenkins
#+end_src
** apt-get: what package provide this file?

#+begin_src sh
apt-get install apt-file
apt-file update
apt-file find <file>
#+end_src
* Rpm
** list files installed by a package?
#+begin_src sh
rpm -ql [packageName]
#+end_src

